<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>一平米卫士</title>
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    name="viewport">
  <meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
  <meta content="no-cache" http-equiv="pragma">
  <meta content="0" http-equiv="expires">
  <meta content="telephone=no, address=no" name="format-detection">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="stylesheet" href="css/reset.css">
  <link rel="stylesheet" href="css/style.css?v=20190604">
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
  <script src="js/jquery.mutouch.min.js"></script>
  <script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
</head>

<body>
  <div class="wrap">
    <div class="main jq-page1">
      <img src="img/bg_index_big.jpg">
      <div class="pos">
        <video id="myvideo" class="pos" preload="auto" controls poster="img/poster.jpg" webkit-playsinline playsinline>
          <source src="css/tmall.mp4">
        </video>
        <a href="javascript:;" class="pos btn-join"><img src="img/btn_join.png"></a>
        <img src="img/icon_jt.png" class="pos img-jt3 ani-jt">
      </div>
    </div>
    <div class="main jq-page2">
      <img src="img/bg_main_big.jpg">
      <div class="pos">
        <a href="javascript:;" class="pos btn-rule"></a>
        <span class="pos txt-total">感谢您成为第<span class="jq-total">
          <img src="img/icon_num1.png">
          <img src="img/icon_num2.png">
          <img src="img/icon_num2.png">
          <img src="img/icon_num2.png">
          <img src="img/icon_num2.png">
          <img src="img/icon_num2.png">
          <img src="img/icon_num2.png">
        </span>位</span>
        <ul class="pos country">
          <li class="active">
            <div class="unlock">
              <span class="txt">目前已解锁<span class="jq-num"></span>个国家<br>珊瑚礁清洁点</span>
              <img src="img/1_unlock.png">
            </div>
            <div class="lock">
              <span class="txt">将在助力人数达到<br><span class="jq-people">1000</span>解锁</span>
              <img src="img/1_lock.png">
            </div>
          </li>
          <li class="">
            <div class="unlock">
              <span class="txt">目前已解锁<span class="jq-num"></span>个国家<br>珊瑚礁清洁点</span>
              <img src="img/2_unlock.png">
            </div>
            <div class="lock">
              <span class="txt">将在助力人数达到<br><span class="jq-people">1000</span>解锁</span>
              <img src="img/2_lock.png">
            </div>
          </li>
          <li class="">
            <div class="unlock">
              <span class="txt">目前已解锁<span class="jq-num"></span>个国家<br>珊瑚礁清洁点</span>
              <img src="img/3_unlock.png">
            </div>
            <div class="lock">
              <span class="txt">将在助力人数达到<br><span class="jq-people">1000</span>解锁</span>
              <img src="img/3_lock.png">
            </div>
          </li>
          <li class="">
            <div class="unlock">
              <span class="txt">目前已解锁<span class="jq-num"></span>个国家<br>珊瑚礁清洁点</span>
              <img src="img/4_unlock.png">
            </div>
            <div class="lock">
              <span class="txt">将在助力人数达到<br><span class="jq-people">1000</span>解锁</span>
              <img src="img/4_lock.png">
            </div>
          </li>
          <li class="">
            <div class="unlock">
              <span class="txt">目前已解锁<span class="jq-num"></span>个国家<br>珊瑚礁清洁点</span>
              <img src="img/5_unlock.png">
            </div>
            <div class="lock">
              <span class="txt">将在助力人数达到<br><span class="jq-people">1000</span>解锁</span>
              <img src="img/5_lock.png">
            </div>
          </li>
          <li class="">
            <div class="unlock">
              <span class="txt">目前已解锁<span class="jq-num"></span>个国家<br>珊瑚礁清洁点</span>
              <img src="img/6_unlock.png">
            </div>
            <div class="lock">
              <span class="txt">将在助力人数达到<br><span class="jq-people">1000</span>解锁</span>
              <img src="img/6_lock.png">
            </div>
          </li>
          <li class="">
            <div class="unlock">
              <span class="txt">目前已解锁<span class="jq-num"></span>个国家<br>珊瑚礁清洁点</span>
              <img src="img/7_unlock.png">
            </div>
            <div class="lock">
              <span class="txt">将在助力人数达到<br><span class="jq-people">1000</span>解锁</span>
              <img src="img/7_lock.png">
            </div>
          </li>
          <li class="">
            <div class="unlock">
              <span class="txt">目前已解锁<span class="jq-num"></span>个国家<br>珊瑚礁清洁点</span>
              <img src="img/8_unlock.png">
            </div>
            <div class="lock">
              <span class="txt">将在助力人数达到<br><span class="jq-people">1000</span>解锁</span>
              <img src="img/8_lock.png">
            </div>
          </li>
        </ul>
        <img src="img/bg_bubble.png" class="pos img-bubble ani-bubble">
        <a href="javascript:;" class="pos btn-pre ani-jt"><img src="img/btn_pre.png"></a>
        <a href="javascript:;" class="pos btn-next ani-jt"><img src="img/btn_next.png"></a>
        <ul class="pos dots">
          <li class="active"></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
        </ul>
        <a href="https://wx.padi.com.cn/?utm_source=tmall" class="pos btn-padi"></a>
        <a href="javascript:;" class="pos btn-more"></a>
        <img src="img/icon_jt.png" class="pos img-jt1 ani-jt">
        <img src="img/icon_jt.png" class="pos img-jt2 ani-jt">
      </div>
    </div>
    <div class="mask mask-rule">
      <img src="img/bg_rule_big.jpg">
      <a href="javascript:;" class="pos btn-close"></a>
    </div>
    <div class="mask mask-more">
      <img src="img/bm.png">
    </div>
  </div>
</body>
<script>
  $(function () {
    $(".btn-join").click(function(){
      $('.jq-page1').hide()
      var video = $("#myvideo")[0]
      video.pause()
      $('.jq-page2').show()
    })
    $.ajax({
      type : 'GET',
      url : '/getWxShareData?url='
        + encodeURIComponent(window.location.href)
        + '&timestamp=' + new Date().getTime(),
      dataType : 'json',
      success : function(data) {
        if (data.status == 0) {
          var configData = {
            appId : data.appId,
            timestamp : data.timestamp,
            nonceStr : data.nonceStr,
            signature : data.signature,
            jsApiList : [ 'updateAppMessageShareData',
                'updateTimelineShareData',
                'onMenuShareTimeline',
                'onMenuShareAppMessage' ]
          };
          wx.config(configData);
          wx.ready(function() {
            var shareData = {
              title : data.shareTitle,
              desc : data.shareDesc,
              link : 'https://manage.biaozhihudong.com',
              imgUrl : data.shareImgUrl,
              success : function() {
              }
            };
            wx.updateAppMessageShareData(shareData);
            wx.updateTimelineShareData(shareData);
            wx.onMenuShareTimeline(shareData);
            wx.onMenuShareAppMessage(shareData);
          });
        } else {
          console.log(data);
          alert('获取签名错误。')
        }
      },
      error : function() {
        alert('获取微信js签名出错，请重试!')
      }
    });
    $.ajax({
      type: 'GET',
      url: '/getInfo?v=' + new Date().getTime(),
      dataType: 'json',
      success: function(data) {
        // var total = data.total
        // var countryList = data.countryList
        init(data.total, data.countryList)
      },
      error: function() {
        alert('网络异常，请重试!')
        setTimeout(function() {
          window.location.reload(true)
        }, 1000)
      }
    })
    var nowIndex = 0
    $(".btn-pre").click(function(){
      nowIndex--
      nowIndex = nowIndex <= 0 ? 0 : nowIndex
      gotoNowIndex()
    })
    $(".btn-next").click(function(){
      nowIndex++
      nowIndex = nowIndex >= 8 ? 7 : nowIndex
      gotoNowIndex()
    })
    $("ul.country, .img-bubble").mutouch({
      offsetX: 70,
      onSwipeLeft: function() {
        //从右往左滑动事件
        $(".btn-next").click()
      },
      onSwipeRight: function() {
        //从左往右滑动事件
        $(".btn-pre").click()
      }
    })
    $(".btn-rule").click(function(){
      $(".mask-rule").show()
    })
    $(".btn-close").click(function(){
      $(".mask-rule").hide()
    })
    $(".btn-more").click(function(){
      $(".mask-more").show()
    })
    $(".mask-more").click(function(){
      $(".mask-more").hide()
    })
    function gotoNowIndex() {
      $(".country .active, .dots .active").removeClass('active')
      $(".country li").eq(nowIndex).addClass('active')
      $(".dots li").eq(nowIndex).addClass('active')
    }
    function init(total, countryList) {
      // setCountryList()
      total = total * 1
      for(var i in countryList) {
        if(total - countryList[i] >= 0) {
          $(".country li").eq(i).find(".unlock").show().siblings(".lock").hide()
          $(".jq-num").text(i*1 + 1)
          nowIndex = i
          gotoNowIndex()
        }
        $(".country li").eq(i).find(".jq-people").text(countryList[i])
      }
      // setTatal()
      $(".jq-total").empty()
      total += ""
      for(var i in total) {
        $('<img src="img/icon_num' + total[i] + '.png">').appendTo(".jq-total")
      }
    }
  })
</script>

</html>